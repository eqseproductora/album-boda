<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administraci√≥n de Fotos - Boda</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { background-color: #f3f4f6; }
        .btn { transition: all 0.2s; }
        .btn:active { transform: scale(0.95); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, orderBy, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDUToiwZx4f6sI0DrYQt9kdNT-jlxlKeys",
            authDomain: "proyeccion-boda.firebaseapp.com",
            projectId: "proyeccion-boda",
            storageBucket: "proyeccion-boda.firebasestorage.app",
            messagingSenderId: "163164812654",
            appId: "1:163164812654:web:ffa2b0042f19f1fa0d7d7f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const { useState, useEffect } = React;

        function AdminPanel() {
            const [photos, setPhotos] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const q = query(collection(db, "photos"), orderBy("timestamp", "desc"));
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    const loadedPhotos = [];
                    snapshot.forEach((doc) => {
                        loadedPhotos.push({ id: doc.id, ...doc.data() });
                    });
                    setPhotos(loadedPhotos);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            const downloadImage = (base64Url, author, index) => {
                const link = document.createElement('a');
                link.href = base64Url;
                // Nombre del archivo al descargar
                link.download = `Boda_${author}_${index}.jpg`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const deleteImage = async (id) => {
                if (confirm('¬øEst√°s seguro de borrar esta foto? No se puede recuperar.')) {
                    await deleteDoc(doc(db, "photos", id));
                }
            };

            return (
                <div className="container mx-auto p-8">
                    <div className="flex justify-between items-center mb-8">
                        <h1 className="text-3xl font-bold text-gray-800">üì∏ Galer√≠a del Administrador</h1>
                        <div className="text-gray-600 font-semibold">
                            Total fotos: {photos.length}
                        </div>
                    </div>

                    {loading ? (
                        <p className="text-center text-gray-500">Cargando galer√≠a...</p>
                    ) : (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                            {photos.map((photo, index) => (
                                <div key={photo.id} className="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200 flex flex-col">
                                    <div className="relative h-64 bg-gray-100">
                                        <img src={photo.url} className="w-full h-full object-cover" />
                                    </div>
                                    <div className="p-4 flex-1 flex flex-col justify-between">
                                        <div>
                                            <p className="font-bold text-gray-800">{photo.author}</p>
                                            {photo.message && <p className="text-sm text-gray-500 italic mt-1">"{photo.message}"</p>}
                                        </div>
                                        
                                        <div className="flex gap-2 mt-4 pt-4 border-t border-gray-100">
                                            <button 
                                                onClick={() => downloadImage(photo.url, photo.author, index)}
                                                className="btn flex-1 bg-blue-600 text-white py-2 rounded-lg text-sm font-bold hover:bg-blue-700 flex justify-center items-center gap-2">
                                                ‚¨áÔ∏è Descargar
                                            </button>
                                            <button 
                                                onClick={() => deleteImage(photo.id)}
                                                className="btn px-3 bg-red-100 text-red-600 rounded-lg text-sm font-bold hover:bg-red-200">
                                                üóëÔ∏è
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AdminPanel />);
    </script>
</body>
</html>
