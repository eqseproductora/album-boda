<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyector Boda</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap');
        body { background: #1a1a1a; overflow: hidden; }
        .ken-burns { animation: kb 10s ease-out forwards; }
        @keyframes kb { from { transform: scale(1); } to { transform: scale(1.1); } }
        .fade-enter { opacity: 0; }
        .fade-enter-active { opacity: 1; transition: opacity 1s ease-in; }
    </style>
</head>
<body class="flex items-center justify-center h-screen w-screen">

    <div class="relative w-[90vw] h-[85vh] bg-white border-8 border-[#D4AF37] shadow-2xl rounded-lg overflow-hidden flex flex-col">
        <div class="h-24 flex flex-col justify-center items-center bg-[#fdfbf7] border-b border-[#D4AF37]">
            <h1 class="font-serif text-4xl text-[#C19A6B] font-bold">Nuestra Boda</h1>
            <p class="text-[#D4AF37] tracking-[0.3em] text-sm uppercase">Momentos en Vivo</p>
        </div>

        <div class="flex-1 relative bg-black overflow-hidden flex items-center justify-center">
            <p id="wait-msg" class="text-white/50 font-serif animate-pulse">Esperando fotos...</p>
            <img id="main-img" class="absolute inset-0 w-full h-full object-contain opacity-0 transition-opacity duration-1000" />
        </div>

        <div class="h-20 bg-[#fdfbf7] border-t border-[#D4AF37] flex items-center justify-center">
            <p id="caption" class="font-serif text-2xl text-[#C19A6B] font-bold"></p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // CONFIGURACIÃ“N (Misma que index)
        const firebaseConfig = {
            apiKey: "AIzaSyDUToiwZx4f6sI0DrYQt9kdNT-jlxlKeys",
            authDomain: "proyeccion-boda.firebaseapp.com",
            projectId: "proyeccion-boda",
            storageBucket: "proyeccion-boda.firebasestorage.app",
            messagingSenderId: "163164812654",
            appId: "1:163164812654:web:ffa2b0042f19f1fa0d7d7f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const imgEl = document.getElementById('main-img');
        const captionEl = document.getElementById('caption');
        const waitMsg = document.getElementById('wait-msg');

        // Escuchar las Ãºltimas 50 fotos
        const q = query(collection(db, "photos"), orderBy("timestamp", "desc"), limit(50));
        
        let photos = [];
        let index = 0;

        onSnapshot(q, (snapshot) => {
            const newPhotos = [];
            snapshot.forEach(doc => newPhotos.push(doc.data()));
            
            // Si hay fotos nuevas, actualizamos la lista
            if (newPhotos.length > 0) {
                photos = newPhotos;
                waitMsg.style.display = 'none';
                // Si es la primera vez, arrancamos el show
                if (imgEl.style.opacity == '0') showNextPhoto();
            }
        });

        function showNextPhoto() {
            if (photos.length === 0) return;

            // Tomamos la foto actual
            const photo = photos[index];
            
            // Fade Out
            imgEl.style.opacity = 0;

            setTimeout(() => {
                // Cambio de fuente
                imgEl.src = photo.url; // AquÃ­ viene el texto base64
                captionEl.textContent = photo.author !== 'Invitado' ? `ðŸ“¸ ${photo.author}` : '';
                
                // Efecto Ken Burns reset
                imgEl.classList.remove('ken-burns');
                void imgEl.offsetWidth; // Trigger reflow
                imgEl.classList.add('ken-burns');

                // Fade In
                imgEl.style.opacity = 1;

                // Preparar siguiente Ã­ndice (Bucle infinito)
                index = (index + 1) % photos.length;

            }, 1000);
        }

        // Cambiar foto cada 5 segundos
        setInterval(showNextPhoto, 5000);

    </script>
</body>
</html>
