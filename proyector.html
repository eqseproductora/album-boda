// Necesitamos importar query y orderBy también
        import { getFirestore, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ... (Tu código de configuración y variables sigue igual hasta initListener) ...

        // --- CONEXIÓN A FIREBASE CORREGIDA ---
        function initListener() {
            // Escuchamos la colección "photos", ordenadas por fecha (timestamp desc)
            const q = query(collection(db, "photos"), orderBy("timestamp", "desc"));
            
            onSnapshot(q, (snapshot) => {
                const newPhotos = [];
                snapshot.forEach((doc) => {
                    newPhotos.push({ id: doc.id, ...doc.data() });
                });
                
                if (newPhotos.length > 0) {
                    updatePhotosList(newPhotos);
                } else {
                    statusText.textContent = "Esperando la primera foto...";
                }
            }, (error) => {
                console.error("Error Firestore:", error);
                statusText.textContent = "ERROR DE PERMISOS";
                errorDetails.textContent = "Revisa las reglas de Firestore en la consola de Firebase.";
                errorDetails.classList.remove('hidden');
            });
        }

        // Modifica ligeramente updatePhotosList para que no intente re-ordenar si ya vienen ordenadas
        function updatePhotosList(newPhotos) {
             // Ya vienen ordenadas por la query de Firestore
            photos = newPhotos;

            if (photos.length === 0) {
                // ... (igual que antes)
            } else {
                loadingOverlay.classList.add('hidden');
                
                // Si es la primera carga o hay fotos nuevas, reiniciamos para mostrar lo nuevo
                if (photos.length > 0 && !slideTimer) {
                    currentIndex = 0;
                    startSlideshow();
                }
            }
        }
